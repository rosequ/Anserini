package io.anserini.collection;

import com.google.common.base.Preconditions;
import io.anserini.document.JsonTweet;
import io.anserini.document.TrecDocument;
import io.anserini.document.twitter.Status;

import java.io.*;
import java.util.zip.GZIPInputStream;

/**
 * Created by royalsequeira on 2017-05-24.
 */
public class TweetCollectionn<D extends JsonTweet> extends Collection {
  private final BufferedReader br;

  public JsonStatusBlockReader(File file) throws IOException {
    Preconditions.checkNotNull(file);

    if (!file.getName().endsWith(".gz")) {
      throw new IOException("Expecting .gz compressed file!");
    }

    br = new BufferedReader(new InputStreamReader(new GZIPInputStream(new FileInputStream(file)), "UTF-8"));
  }

  /**
   * Returns the next status, or <code>null</code> if no more statuses.
   */
  public Status next() throws IOException {
    Status nxt = null;
    String raw = null;

    while (nxt == null) {
      raw = br.readLine();

      // Check to see if we've reached end of file.
      if (raw == null) {
        return null;
      }

      nxt = Status.fromJson(raw);
    }
    return Status.fromJson(raw);
  }

  public void close() throws IOException {
    br.close();
  }
}
